#!/usr/bin/env zsh

#export MANPAGER=vimpager PAGER=vimpager; alias less=$PAGER
export EDITOR=vim

if tty | grep -qE '^/dev/tty[0-9]+$'; then
    TMOUT=$(( 60 * 20 ))
    echo "setting \$TMOUT=$TMOUT because of a tty login"
fi

if [ -z "$ZSH_PATH_INIT" ] || command -v ruby &> /dev/null
then
    export ZSH_PATH_INIT=1
    [ -e ~/bin ] &&
        export PATH="$(find ~/bin -type d | tr '\n' :)$PATH"

    [ -e ~/.local/bin ] &&
        export PATH="$HOME/.local/bin:$PATH"

    [ -e ~/.tfenv/bin ] &&
        export PATH="$(echo ~/.tfenv/bin):$PATH"

    [ -e "$HOME/.nix-profile/etc/profile.d/nix.sh" ] &&
        . "$HOME/.nix-profile/etc/profile.d/nix.sh"

    [ -n "$ZSH_VERSION" ] && # sourced in the bash-run ~/.xprofile
        command -v direnv &> /dev/null && eval "$(direnv hook zsh)"

    if [ -e ~/.rbenv/bin ]; then
        # git clone https://github.com/rbenv/rbenv.git ~/.rbenv
        # git clone https://github.com/rbenv/ruby-build.git ~/.rbenv/plugins/ruby-build
        export PATH="$HOME/.rbenv/bin:$PATH"
        eval "$(rbenv init -)"
    fi

    if [ -e ~/code/go/pkgs/bin ]; then
        export PATH="$PATH:$HOME/code/go/pkgs/bin"
        export GOPATH="$HOME/code/go/pkgs"
    fi

    if [ -e ~/down/perl5 ]; then
        # generated by cpan
        export PATH="$HOME/down/perl5/bin${PATH:+:${PATH}}"
        export PERL5LIB="$HOME/down/perl5/lib/perl5${PERL5LIB:+:${PERL5LIB}}"
        export PERL_LOCAL_LIB_ROOT="$HOME/down/perl5${PERL_LOCAL_LIB_ROOT:+:${PERL_LOCAL_LIB_ROOT}}"
        export PERL_MB_OPT="--install_base \"/$HOME/down/perl5\""
        export PERL_MM_OPT="INSTALL_BASE=$HOME/down/perl5"
    fi

    if [ -e ~/work/vendor/android ]; then
        export ANDROID_HOME=$HOME/work/vendor/android
        export ANDROID_SDK_HOME=$ANDROID_HOME
        export ANDROID_SDK_ROOT=$ANDROID_HOME
        export PATH=$PATH:$ANDROID_HOME/emulator
        export PATH=$PATH:$ANDROID_HOME/tools
        export PATH=$PATH:$ANDROID_HOME/tools/bin
        export PATH=$PATH:$ANDROID_HOME/platform-tools
    fi
fi

command -v ruby &> /dev/null && \
    PATH="$(ruby -e 'puts $stdin.read.split(":").uniq.join(":")' <<< $PATH)"
